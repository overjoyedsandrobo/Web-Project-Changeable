<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ project_name }}</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body data-auth="{{ 'true' if is_authenticated else 'false' }}" data-user-id="{{ current_user.id if is_authenticated else '' }}">

    <header>
        <div class="header-left">
            <h1>{{ project_name }}</h1>
            <p>Rule-based generative exploration</p>
        </div>
        <div class="header-actions">
            {% if is_authenticated %}
                <span class="header-user">Hi, {{ username }}</span>
                <a class="btn small header-btn" href="{{ url_for('logout') }}">Logout</a>
            {% else %}
                <a class="btn small header-btn" href="{{ url_for('login') }}">Login / Sign Up</a>
            {% endif %}
        </div>
    </header>

    <main>
        <div id="canvas-container">
            <!-- Generation output will go here -->
            <canvas id="generation-canvas"></canvas>
        </div>

        <div id="controls">
            <div class="controls-top">
                <h2>Controls</h2>
                <button id="helpBtn" class="icon-btn" title="Help" aria-label="Help">?</button>
            </div>


            <div class="control-group">
                <label class="label" for="cols">Columns</label>
                <input id="cols" type="number" min="4" max="64" value="16" />
            </div>

            <div class="control-group">
                <label class="label" for="rows">Rows</label>
                <input id="rows" type="number" min="4" max="64" value="16" />
            </div>

            <div class="control-group">
                <div class="legend" id="legend"></div>
            </div>

            <input id="ruleColorPicker" type="color" style="position:fixed; width:1px; height:1px; left:-9999px; opacity:0;" />

            <div class="control-group">
                <button id="generateBtn" class="btn">Generate</button>
            </div>
            
            
            <div class="control-group">
                <label class="label" for="seed">Seed</label>
                <input id="seed" type="number" min="0" max="999999999" value="123456789" />
            </div>

            <div class="control-group">
                <label class="label">
                    <input id="showGrid" type="checkbox" checked />
                    Show grid overlay
                </label>
            </div>
            
            <div class="control-group">
                <label class="label">Symmetry</label>
                <div class="btn-row">
                    <button id="mirrorXBtn" class="btn small">Mirror X</button>
                    <button id="mirrorYBtn" class="btn small">Mirror Y</button>
                    <button id="rotateBtn" class="btn small">Rotate 90°</button>
                </div>
            </div>
            <div class="control-group">
                <label class="label">History</label>
                <div class="btn-row">
                    <button id="undoBtn" class="btn small">Undo</button>
                    <button id="redoBtn" class="btn small">Redo</button>
                    <button id="clearBtn" class="btn small">Clear</button>
                </div>
                <div class="hint">Ctrl+Z / Ctrl+Y (or Ctrl+Shift+Z).</div>
            </div>

  
            <div class="control-group">
                <label class="label">Save / Load</label>
                <div class="btn-row">
                    <button id="openSaveModal" class="btn small">Save</button>
                    <button id="openLoadModal" class="btn small">Load</button>
                </div>
            </div>
            <div class="controls-bottom-spacer"></div>
        </div>
    </main>
    <div id="helpModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
        <div class="modal-backdrop" id="helpBackdrop"></div>

        <div class="modal-card">
            <div class="modal-header">
                <h3 id="helpTitle">Help</h3>
                <button id="helpClose" class="icon-btn" aria-label="Close">✕</button>
            </div>

            <div class="modal-body">

            <div class="help-section">
                <h4>Editing the Grid</h4>
                <ul>
                <li><b>Click a rule</b> in the legend to select it.</li>
                <li><b>Right click a legend item</b> to change its color.</li>
                <li><b>Left click / drag</b> paints the selected rule.</li>
                <li><b>Shift + click / drag</b> erases a cell (sets it to 0).</li>
                <li><b>Right click / drag</b> also erases.</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>Preview</h4>
                <ul>
                    <li><b>Generate</b> creates an abstract preview based on your rule grid and seed.</li>
                    <li>The grid is a <b>control field</b>, not the final image.</li>
                    <li>Try small edits and generate again to explore variations.</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>Seed & Variations</h4>
                <ul>
                <li><b>Randomize seed on generate</b> (checked): every Generate creates a new variation.</li>
                <li>Uncheck it to make results <b>repeatable</b> using the Seed number.</li>
                <li>Same grid + same seed = same output.</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>Symmetry Tools</h4>
                <ul>
                <li><b>Mirror X</b>: flips the grid left ↔ right.</li>
                <li><b>Mirror Y</b>: flips the grid top ↔ bottom.</li>
                <li><b>Rotate 90°</b>: rotates the grid clockwise (rows/columns swap).</li>
                <li>These tools transform the <b>rule grid</b>, so generation changes automatically.</li>
                </ul>
            </div>

            </div>
               
        </div>
    </div>
    <div id="previewModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="previewTitle">
        <div class="modal-backdrop" id="previewBackdrop"></div>

        <div class="modal-card preview-card">
            <div class="modal-header">
                <h3 id="previewTitle">Preview</h3>
                <button id="previewClose" class="icon-btn" aria-label="Close">✕</button>
            </div>

            <!-- canvas area -->
            <div class="preview-body">
                <canvas id="previewCanvas"></canvas>
            </div>

            <!-- footer area -->
            <div class="preview-footer">
                <div class="preview-actions">
                    <button id="previewRegenerateBtn" class="btn">New variation</button>
                    <button id="previewExportPngBtn" class="btn">Export PNG</button>
                </div>

                <div class="hint" id="previewMeta"></div>
            </div>
        </div>
    </div>

    <div id="saveModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="saveTitle">
        <div class="modal-backdrop" id="saveBackdrop"></div>
        <div class="modal-card save-card">
            <div class="modal-header">
                <h3 id="saveTitle">Save Design</h3>
                <button id="saveClose" class="icon-btn" aria-label="Close">✕</button>
            </div>
            <div class="modal-body">
                <label class="label" for="designName">Name</label>
                <input id="designName" class="input" placeholder="My design" />

                <label class="label">Visibility</label>
                <div class="segmented">
                    <label class="segmented-item">
                        <input type="radio" name="designVisibility" value="private" checked />
                        <span>Private</span>
                    </label>
                    <label class="segmented-item">
                        <input type="radio" name="designVisibility" value="public" />
                        <span>Public</span>
                    </label>
                </div>

                <button id="saveBtn" class="btn">Save to Database</button>
            </div>
        </div>
    </div>

    <div id="loadModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="loadTitle">
        <div class="modal-backdrop" id="loadBackdrop"></div>
        <div class="modal-card load-card">
            <div class="modal-header">
                <h3 id="loadTitle">Load Design</h3>
                <div class="modal-actions">
                    <button id="togglePrivateView" class="btn small ghost">My Private</button>
                    <button id="loadClose" class="icon-btn" aria-label="Close">✕</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="publicGallerySection">
                    <label class="label" for="publicSearch">Public Gallery</label>
                    <input id="publicSearch" class="input" placeholder="Search public designs..." />
                    <div class="design-grid" id="publicDesignGrid"></div>
                </div>

                <div id="privateGallerySection" class="hidden">
                    <label class="label">Your Private Gallery</label>
                    <div class="design-grid small" id="privateDesignGrid"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="loadBtn" class="btn">Load Selected</button>
            </div>
        </div>
    </div>

    <div id="designContextMenu" class="design-menu hidden">
        <button id="designDeleteBtn" class="btn small danger">Delete</button>
    </div>


    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
